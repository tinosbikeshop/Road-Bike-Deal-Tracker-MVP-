<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Road Bike Deals — Test Viewer</title>
<style>
  :root{--bg:#0b0c10;--card:#11141a;--text:#e9eef3;--muted:#9aa7b5;--brand:#1f6feb}
  *{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:var(--text)}
  header{padding:16px;border-bottom:1px solid #1f232b}
  h1{margin:0;font-size:18px}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .store{margin-top:18px}
  .store h2{font-size:16px;margin:0 0 6px}
  .category{margin:10px 0 2px;color:var(--muted);font-size:13px}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
  .card{background:#0f1116;border:1px solid #263043;border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
  .thumb{width:100%;height:160px;background:#0b0c10;display:grid;place-items:center}
  .thumb img{max-width:100%;max-height:100%;object-fit:contain}
  .body{padding:10px;display:flex;flex-direction:column;gap:8px}
  .name{font-size:14px;line-height:1.3}
  .meta{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:12px}
  .price{font-weight:700}
  .pill{background:#122a46;color:#78b2ff;border-radius:999px;padding:2px 8px;font-size:12px}
  .footer{display:flex;justify-content:space-between;align-items:center}
  a.btn{background:var(--brand);color:#fff;padding:6px 10px;border-radius:8px;text-decoration:none;font-size:13px}
  @media (max-width:480px){ .thumb{height:140px} }
</style>
</head>
<body>
<header><h1>Road Bike Deal Tracker — Test Feed</h1></header>
<div class="wrap" id="app">Loading…</div>
<script>
async function load(){
  try{
    const res = await fetch('./deals.sample.json', {cache:'no-store'});
    const data = await res.json();
    const app = document.getElementById('app');
    app.innerHTML = '';
    for(const storeName of Object.keys(data).filter(k=>k!=='meta')){
      const store = data[storeName];
      const storeDiv = document.createElement('div');
      storeDiv.className = 'store';
      storeDiv.innerHTML = `<h2>${storeName}</h2>`;
      for(const cat of Object.keys(store)){
        const items = store[cat] || [];
        if(!items.length) continue;
        const catEl = document.createElement('div');
        catEl.className = 'category';
        catEl.textContent = cat;
        const grid = document.createElement('div');
        grid.className = 'grid';
        for(const it of items){
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <div class="thumb">${it.image ? `<img src="${it.image}" alt="">` : ''}</div>
            <div class="body">
              <div class="name">${it.name}</div>
              <div class="meta"><span class="price">${it.price} ${it.currency||''}</span><span class="pill">-${(it.discount||0)}%</span></div>
              <div class="footer">
                <small>${new Date(it.last_updated).toLocaleString()}</small>
                <a class="btn" href="${it.url}" target="_blank" rel="noopener">View</a>
              </div>
            </div>`;
          grid.appendChild(card);
        }
        storeDiv.appendChild(catEl);
        storeDiv.appendChild(grid);
      }
      app.appendChild(storeDiv);
    }
  }catch(e){
    document.getElementById('app').textContent = 'Failed to load data';
  }
}
load();
</script>
</body>
</html>
